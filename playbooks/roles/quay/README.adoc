= openshift_virtualization role

This role allows to install/uninstall Quay in an OpenShift cluster.

== Requirements

* Ansible 2.9
* OpenShift 4.10

== Role Variables

List of variables used by the role. The ones marked as _required_ need to be added to the playbook.

[cols="4*<.^",options=header]
|===
|Variable |Description | Required | Default 

|kubeconfig_path | Path to the kubeconfig file | Yes | None

|rhocp_user | OpenShift user | Yes | None

|provisioner_ip | IP Address of the provisioner host | Yes | None

|domain | Domain | Yes | None

|quay_password |Quay admin password. | Yes | None

|quay_user |Name of the user to use with Quay.  | Yes | No

|quay_email |Email of the user to use with Quay.  | Yes | No

|pull_secret_path | Path to a pull secret | Yes | None

|apps_ns |Namespace used to install the applications that will run in the management cluster. | Yes | mano-apps

|quay_ns |Namespace used to install the Quay operator. | No | quay-enterprise

|quay_operator_name |Name of Quay operator.  | No | quay-operator

|quay_channel |Name of the Quay operator channel.  | No | stable-3.7

|quay_fqdn |Quay FQDN.  | No | quay.apps.{{ domain }}_

|quay_user |Name of the user to use with Quay.  | No | quay

|quay_email |Email of the user to use with Quay.  | No | quay@quay.com

|ocp_rel_maj |Major version of the OpenShift release.  | No | 4

|ocp_rel_min |Minor version of the OpenShift release.  | No | 10

|ocp_rel_mnt |Maintenance version of the OpenShift release.  | No | 16

|ocp_release |OpenShift release.  | No | 4.10

|ai_version |Assisted Installer version.  | No | v1.0.24.2

|local_secret_json |Name of the pull secret file.  | No | pull-secret-update.json

|agent_version |Agent version.  | No | v2.0.3

|ospd_release |OpenStack Platform Director version.  | No | 1.2.1

|UPSTREAM_URL_REGISTRY |URL of the registry used to pull images.  | No | registry.redhat.io

|quay_cert_dir |Path to the directory where Quay certs will be stored.  | No | /opt/quay/certs

|quay_cert_file_owner |Owner of the Quay cert.  | No | "{{ ansible_env.USER }}"

|quay_cert_file_group |Group owner of the Quay cert. | No | "{{ quay_cert_file_owner }}"
 
|quay_cert_file_prefix |Prefix used for the cert files. | No | quay

|quay_ca_path |Path to the CA.  | No | "{{ quay_cert_dir }}/{{ quay_cert_file_prefix }}CA.crt"

|quay_key_path |Path to the Key. | No | "{{ quay_cert_dir }}/{{ quay_cert_file_prefix }}.key"

|quay_csr_path |Path to the .csr file. | No | "{{ quay_cert_dir }}/{{ quay_cert_file_prefix }}.csr"

|quay_cert_path |Path to the certificate. | No | "{{ quay_cert_dir }}/{{ quay_cert_file_prefix }}.crt"

|quay_cert_common_name |Quay certificate common name. | No | "{{ quay_fqdn }}"

|quay_cert_country |Quay certificate country. | No | US

|quay_cert_locality |Quay certificate locality. | No | Raleigh

|quay_cert_organization |Quay certificate organization. | No | Red Hat, Inc.

|quay_cert_organizational_unit |Quay certificate organizational unit. | No | Lab

|quay_cert_state |Quay certificate state. | No | NC

|scripts_path |Directory that stores scripts dynamically generated by the automation. | No | /tmp/automation/script

|home_path |Home directory in the bastion server. | No | ~

|===

== Examples

Example playbook to install Quay getting required variables from the playbook_required_vars.yml file:

[source, yaml]
----
- name: Playbook to install Quay
  hosts: provisioner_host
  vars_file:
    - playbook_required_vars.yml
  roles:
    - role: quay
      state: present
----

Example playbook to uninstall Quay getting required variables from the playbook_required_vars.yml file:

[source, yaml]
----
- name: Playbook to uninstall Quay
  hosts: provisioner_host
  vars_file:
    - playbook_required_vars.yml
  roles:
    - role: quay
      state: absent
----

== License

TBD

== Author Information

Alaitz Mendiola <alaitz@redhat.com>
